# Maintenance Guide

This document provides guidance for maintaining the SonarMark project.

## Table of Contents

- [Overview](#overview)
- [Regular Maintenance Tasks](#regular-maintenance-tasks)
- [Dependency Management](#dependency-management)
- [Quality Checks](#quality-checks)
- [Requirements Traceability](#requirements-traceability)
- [Release Process](#release-process)
- [Troubleshooting](#troubleshooting)

## Overview

SonarMark follows strict quality standards with zero-tolerance for build warnings,
comprehensive testing, and automated requirements traceability. This guide helps
maintainers uphold these standards.

## Regular Maintenance Tasks

### Weekly Tasks

1. **Review Dependabot PRs**
   - Dependabot runs weekly on Mondays
   - Review and merge dependency updates
   - Verify all CI checks pass

2. **Check Security Alerts**
   - Review GitHub Security tab
   - Address any CodeQL findings
   - Check SonarCloud dashboard

### Monthly Tasks

1. **Review Test Coverage**
   - Ensure coverage remains above 80%
   - Add tests for new features
   - Update requirements.yaml for new functionality

2. **Update Documentation**
   - Review and update README.md
   - Update CHANGELOG.md for releases
   - Verify all documentation builds correctly

## Dependency Management

### Checking for Updates

```bash
# Check for outdated packages
dotnet list package --outdated

# Check for vulnerable packages
dotnet list package --vulnerable --include-transitive

# Using VS Code task
# Run: "check dependencies" or "check vulnerabilities"
```

### Updating Dependencies

```bash
# Update all NuGet packages
dotnet restore

# Update dotnet tools
dotnet tool restore
dotnet tool update <tool-name>

# Update NPM packages
npm update
```

### Adding New Dependencies

Before adding a new dependency:

1. Check for security vulnerabilities
2. Verify license compatibility (must be MIT-compatible)
3. Check maintenance status (actively maintained)
4. Consider package size and dependencies
5. Add to appropriate .csproj file with version pinning

## Quality Checks

### Running All Checks Locally

```bash
# Quick check
./lint.sh  # or lint.bat on Windows

# Full maintenance check
dotnet build --no-restore --configuration Release
dotnet test --no-build --configuration Release
dotnet reqstream --requirements requirements.yaml --tests "test-results/**/*.trx" --enforce
```

### Using VS Code Tasks

- **Build**: `Ctrl+Shift+B` (or `Cmd+Shift+B` on macOS)
- **Test**: `Ctrl+Shift+T`
- **Lint All**: Run task "lint all"
- **Maintenance Check**: Run task "maintenance check"

### Quality Standards

1. **Zero Warnings**: All builds must complete with zero warnings
2. **All Tests Pass**: 100% test pass rate required
3. **Requirements Traceability**: All requirements must link to passing tests
4. **Code Coverage**: Maintain >80% coverage
5. **Security**: No known vulnerabilities in dependencies

## Requirements Traceability

### Maintaining requirements.yaml

The `requirements.yaml` file defines all project requirements and links them to tests.

#### Structure

```yaml
sections:
  - title: "Section Name"
    requirements:
      - id: "PREFIX-NNN"
        title: "Requirement description"
        tests:
          - "TestName1"
          - "TestName2"
```

#### Adding a New Requirement

1. Choose appropriate section (CLI, SONAR, RPT, VAL, ENF, PLT)
2. Assign next sequential ID in that section
3. Write clear requirement title
4. Link to one or more test methods
5. Verify with: `dotnet reqstream --requirements requirements.yaml --tests "test-results/**/*.trx" --enforce`

#### Verifying Traceability

```bash
# Run tests first to generate TRX files
dotnet test --configuration Release --logger "trx" --results-directory test-results

# Verify requirements
dotnet reqstream --requirements requirements.yaml --tests "test-results/**/*.trx" --enforce
```

### Test Naming Conventions

- **Integration Tests**: `IntegrationTest_Feature_Behavior`
- **Unit Tests**: `ClassName_Method_Scenario_ExpectedResult`
- **Validation Tests**: `SonarMark_Feature` (generated by --validate flag)

## Release Process

### Pre-Release Checklist

1. ✅ All CI checks pass
2. ✅ Version updated in CHANGELOG.md
3. ✅ Documentation updated
4. ✅ Requirements traceability verified
5. ✅ No pending security issues
6. ✅ Release notes prepared

### Creating a Release

1. **Update CHANGELOG.md**

   ```markdown
   ## [X.Y.Z] - YYYY-MM-DD

   ### Added
   - New features

   ### Changed
   - Modified features

   ### Fixed
   - Bug fixes
   ```

2. **Run Release Workflow**
   - Go to Actions → Release
   - Click "Run workflow"
   - Enter version (e.g., "1.2.0")
   - Select publish type:
     - `none`: Build only (testing)
     - `release`: Create GitHub release
     - `publish`: Create release + publish to NuGet.org

3. **Verify Release**
   - Check GitHub Releases page
   - Verify NuGet.org package (if published)
   - Test installation: `dotnet tool install -g DemaConsulting.SonarMark --version X.Y.Z`

### Version Numbering

Follow [Semantic Versioning](https://semver.org/):

- **Major** (X.0.0): Breaking changes
- **Minor** (0.X.0): New features, backward compatible
- **Patch** (0.0.X): Bug fixes, backward compatible

## Troubleshooting

### Build Warnings

If you encounter build warnings:

1. Treat them as errors (TreatWarningsAsErrors=true)
2. Fix immediately before committing
3. Use `#pragma warning disable` only with justification and code review approval

### Test Failures

If tests fail:

1. Run locally: `dotnet test --configuration Release`
2. Check test output for error details
3. Verify test data and dependencies
4. Check for environment-specific issues

### Requirements Traceability Failures

If requirements enforcement fails:

1. Run tests: `dotnet test --logger "trx" --results-directory test-results`
2. Verify validation.trx exists if using --validate flag
3. Check test names match requirements.yaml exactly
4. Ensure TRX files are in test-results directory

### CI/CD Issues

If workflows fail:

1. Check workflow logs in GitHub Actions
2. Verify secrets are configured (SONAR_TOKEN, DEMACONSULTINGNUGETKEY)
3. Check for GitHub Actions service issues
4. Verify workflow permissions are correct

## Best Practices

### Code Quality

1. Write tests before code (TDD)
2. Keep test coverage above 80%
3. Use meaningful names (methods, variables, tests)
4. Document complex logic with XML comments
5. Follow .editorconfig settings

### Git Practices

1. Write clear commit messages
2. Keep commits focused and atomic
3. Reference issues in commit messages
4. Use conventional commits format
5. Rebase feature branches before merging

### Security

1. Never commit secrets or tokens
2. Review Dependabot security alerts promptly
3. Address CodeQL findings
4. Keep dependencies updated
5. Follow least privilege principle

## Resources

- [GitHub Repository](https://github.com/demaconsulting/SonarMark)
- [SonarCloud Dashboard](https://sonarcloud.io/project/overview?id=demaconsulting_SonarMark)
- [NuGet Package](https://www.nuget.org/packages/DemaConsulting.SonarMark)
- [Contributing Guidelines](CONTRIBUTING.md)
- [Code of Conduct](CODE_OF_CONDUCT.md)
- [Security Policy](SECURITY.md)

## Getting Help

- **Issues**: [GitHub Issues](https://github.com/demaconsulting/SonarMark/issues)
- **Discussions**: [GitHub Discussions](https://github.com/demaconsulting/SonarMark/discussions)
- **Email**: <support@demaconsulting.com>

## Maintenance History

For maintenance history and reviews, see the project's maintenance review documents
in the repository root.

---

**Last Updated:** 2026-01-28  
**Maintained By:** DEMA Consulting
